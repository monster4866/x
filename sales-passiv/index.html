<script>
    const currentDateStart = new Date().getTime();
</script>
<!DOCTYPE html>
<html lang="de" ng-app="app" ng-controller="AppController">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>project cherry v7.3 | Verm√∂gensberatung</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/gobal.css" />

    <style>
        main{
            overflow-y: scroll;
            overflow-x: hidden;
            height: calc(100% - 72px);
        }
        nav{
            display: inline-block;
            width: 100%;
            height: 72px;
            transition: 0.35s ease-out;
            backgroundx: #a29bfe;
            padding: 8px;
            box-shadowx: 0 2px 2px 0 rgb(0 0 0 / 14%), 0 3px 1px -2px rgb(0 0 0 / 20%), 0 1px 5px 0 rgb(0 0 0 / 12%);
            z-index: 100;
            position: relative;
        }
        nav-rail a {
            margin-bottom: 4px;
        }
        nav .nav-btn2,
        nav .nav-btn{
            animation: 0.25s ease 0s 1 slideInFromTop;
        }
        nav .nav-btn2 a{
            margin-right: 4px;
        }
        nav .nav-btn2 a:first-child,
        nav .nav-btn2 a:last-child{
            margin: 0;
        }
        nav .nav-actions a {
            animation: 0.25s ease 0s 1 slideZoom;
            margin-right: 4px;
        }

        @keyframes slideZoom {
            0% {-webkit-transform: scale(0);opacity: 1;}
            75% {-webkit-transform: scale(1.05)}
            100% {-webkit-transform: scale(1)}
        }
        @keyframes slideInFromTop {
            0% {-webkit-transform: translateY(-8px);opacity: 0}
            100% {-webkit-transform: translateY(0);opacity:1}
        }
        nav-rail a:first-child {
            margin-top: 16px;
            margin-bottom: 48px;
        }
        nav-bar{
            background: var(--tertiary-color-95);
            animation: 0.35s ease 0s 1 slideInFromBottom;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 8px 8px 8px 8px;
            z-index: 1000;
        }

        @keyframes slideInFromBottom {
            0% {-webkit-transform: translateY(64px);opacity:0}
            100% {-webkit-transform: translateX(0);opacity:1}
        }
        .item:hover{
            background: var(--tertiary-color-95);
        }
        .item.active{
            background: var(--tertiary-color-90);
        }
    </style>
    <style>
        .container-grid{
            display: grid;
            column-gap: 8px;
            row-gap: 8px;
            padding: 16px 0;
        }
        .card{
            width: 100%;
            min-height: 128px;
            height: 35vh;
        }
        .container-grid h3.card-title{
            font-size: 16px;
        }
        @media (max-width: 576px) {
            .container-grid{grid-template-columns: 1fr}
            .card{height: 160px;width: 100%}
            .container-grid h3.card-title{font-size: 20px}
            .container{overflow-x: hidden}
            main{height: calc(100% - 80px);}
        }
        @media (min-width: 576px) {
        }
        @media (max-width: 768px) {
            .container-grid{grid-template-columns: 1fr}
        }
        @media (min-width: 992px) {
            .container-grid{grid-template-columns: 1fr 1fr 1fr}
        }
        @media (min-width: 1200px) {
            .container-grid h3.card-title{font-size: 20px}
        }
    </style>
    <style>
        .fadein {
            opacity: 0;
            -webkit-transition: .25s ease all; /* Safari/Chrome */
            -moz-transition: .25s ease all; /* Firefox */
            -o-transition: .25s ease all; /* Opera */
            transition: .25s ease all; /* IE10+ and Future Browsers */
            animation: 0.25s ease 0s forwards 1 popin-animation;
        }
        @keyframes popin-animation {
            0% {-webkit-transform: translateY(16px);opacity: 0}
            100% {-webkit-transform: translateX(0);opacity:1}
        }
        .plansitem,.plansitem2{
            background: var(--tertiary-color-95);
            border-radius: 12px;
            display: inline-grid;
        }
        .plansitem:hover{
            background: var(--tertiary-color-90);
            cursor: pointer;
        }
        .plansitem .sub{
            border-radius: 12px;
            padding: 4px 16px;
            background: var(--tertiary-color-90);
            float: left;
        }
        .plansitem .text{
            display: none;
            color: #5f6368;
        }
        .plansitem:hover .text{
            display: block;
        }
    </style>
</head>
<body class="app-ready">

<nav class="d-none d-sm-block">
    <div class="nav-btn">
        <a href="../"
           class="btn fab fab-menu">
            <span class="material-symbols-sharp">menu</span>
        </a>

        <div class="nav-btn2" style="display: inline-block;background: #f2f2f2;border-radius: 28px">
            <a href="#!/home"
               class="btn fab fab-menu"
               ng-class="{'active': $location.split('/')[1] == 'home' }">
                <span class="material-symbols-sharp">home</span>
                Startseite
            </a>
            <a ng-repeat="nav in navs"
               ng-show="$route.current.params.id"
               href="#!/id/{{$route.current.params.id}}/{{nav.href}}"
               class="btn fab fab-menu"
               ng-class="{'active': $location.split('/')[3] == nav.href }">
                <span class="material-symbols-sharp">{{nav.title}}</span>
            </a>
        </div>

        <div class="nav-actions" style="display: inline-block" ng-show="$route.current.params.id">
            <a ng-repeat="acn in navActions"
               ng-show="acn"
               href=""
               class="btn fab fab-menu"
               data-bs-toggle="{{acn.modal}}"
               data-bs-target="#exampleModal"
               style="background: var(--secondary-color-40);color: #FFF">
                <span class="material-symbols-sharp">{{acn.ico}}</span>
                {{acn.title}}
            </a>
        </div>
    </div>
</nav>

<nav class="d-block d-sm-none">
    <div class="nav-btn" style="display: grid;grid-template-columns: 1fr 1fr 1fr 1fr 1fr">
        <a href="../"
           class="btn fab fab-menu">
            <span class="material-symbols-sharp">menu</span>
        </a>
        <a href="#!/home"
           class="btn fab fab-menu"
           ng-class="{'active': $location.split('/')[1] == 'home' }">
            <span class="material-symbols-sharp">home</span>
        </a>
        <a ng-repeat="nav in navs"
           ng-show="$route.current.params.id"
           href="#!/id/{{$route.current.params.id}}/{{nav.href}}"
           class="btn fab fab-menu"
           ng-class="{'active': $location.split('/')[3] == nav.href }">
            <span class="material-symbols-sharp">{{nav.title}}</span>
        </a>
    </div>
</nav>

<nav-action class="d-block d-sm-none">
    <div class="nav-actions" style="position: fixed; right: 16px; bottom: 32px; z-index: 1000" ng-show="$route.current.params.id">
        <a ng-repeat="acn in navActions"
           ng-show="acn"
           href="{{acn.href}}"
           class="btn fab fab-menu"
           data-bs-toggle="{{acn.modal}}"
           data-bs-target="#exampleModal"
           style="background: var(--secondary-color-40);color: #FFF">
            <span class="material-symbols-sharp">{{acn.ico}}</span>
            {{acn.title}}
        </a>
    </div>
</nav-action>

<main ng-view></main>

</body>

<!-- Bootstrap -->
<script src="../js/bootstrap.bundle.min.js"></script>

<!-- ChartJS -->
<script src="../js/chart.js"></script>

<!-- AngularJS -->
<script src="../js/angular.min.js"></script>
<script src="../js/angular-route.min.js"></script>
<script src="../js/angular-cookies.min.js"></script>
<script src="../js/angular-locale_de-de.min.js"></script>

<script>
    /* (c) Copyright Patrick Nolte 2014-2023 All Rights Reserved */

    (function() {
        'use strict';

        const ng = angular.module('app', [
            'ngRoute'
        ]);

        ng.config(['$routeProvider', '$locationProvider',function($routeProvider, $locationProvider) {
            $routeProvider
                .when('/home', {templateUrl: './module/home.html'})
                .when('/home/new', {templateUrl: './module/home-new.html'})
                .when('/home/tasks', {templateUrl: './module/home-tasks.html', controller: 'home-tasks'})
                .when('/id/:id/status', {templateUrl: './module/status.html', controller: 'status'})
                .when('/id/:id/select', {templateUrl: './module/select.html', controller: 'select'})
                .when('/id/:id/offer', {templateUrl: './module/offer.html', controller: 'offer'})
                .when('/id/:id/offer/products', {templateUrl: './module/products.html', controller: 'products'})
                .otherwise({redirectTo: '/home'});
            $locationProvider.html5Mode(false);
            $locationProvider.hashPrefix('!');
        }])

        ng.run(function ($rootScope, $location,$route) {
            $rootScope.$on('$routeChangeSuccess', function () {
                $rootScope.$location = $location.path();
                $rootScope.$route = $route;
                $rootScope.$ID = $route.current.params.id
            })
            angular.element(document).ready(function () {
                const currentDateEnd = new Date().getTime();
                $rootScope.turbo = (currentDateEnd - currentDateStart)/1000;
                $rootScope.$apply()
            });
        })

        /* Controllers */
        ng.controller('AppController', ['$scope','$rootScope','$http', function($scope,$rootScope,$http) {

            /* MASTER */
            $rootScope.master = {
                plans: [],
                wealth: {}
            };

            /* Get Data form ID*/
            $scope.$watch("$ID", function() {
                if(!$rootScope.$ID && $scope.task){
                    $scope.last$ID = $scope.task.ID;
                    return
                }
                if($scope.last$ID == $rootScope.$ID) return;

                $http.get("../tasks.json").then(function(res){
                    $scope.task = res.data[$scope.$ID];
                    $scope.task.ID = $scope.$ID;
                    /* Get Customer Data */
                    $http.get("../customers.json").then(function(res){
                        $scope.customerData = res.data[$scope.task.customerId]});

                    /* Get Account Data */
                    $http.get("../accounts.json").then(function(res){
                        $scope.accountData = res.data[$scope.task.customerId]

                        /* Get Depot Data */
                        $http.get("../depots.json").then(function(res){
                            $scope.depotData = res.data;
                            if(!$scope.accountData) return;
                            $scope.accountData.forEach(function (item, index){
                                if(item.typ === 500){
                                    let sumDepotAmount=0;
                                    $scope.accountData[index]["data"] = $scope.depotData[item.nr]
                                    $scope.accountData[index].data.forEach(function (item){
                                        sumDepotAmount += (item.stk * item.price)
                                    })
                                    $scope.accountData[index]["amount"] = sumDepotAmount
                                }
                            })
                        });
                    });
                });

            }, true);

            $scope.$watch("accountData", function() {
                if(!$scope.accountData) return;

                /* Get Santander Wealth*/
                var wealthSantander = $scope.accountData.filter(function (obj) {
                    return obj.internal === true;
                });
                $rootScope.master.wealth.santander = wealthSantander.map(x => Number(x.amount)).reduce((x, y) => x + y, 0);

                /* Get Liqui */
                $rootScope.master.wealth.liqui = $scope.accountData.filter(function (obj) {
                    return obj.typ < 300 || obj.active;
                }).map(x => Number(x.amount)).reduce((x, y) => x + y, 0);

                $rootScope.master.wealth.sec = $scope.accountData.filter(function (obj) {
                    return obj.typ > 299 && obj.typ < 401 && !obj.active;
                }).map(x => Number(x.amount)).reduce((x, y) => x + y, 0);

                $rootScope.master.wealth.ren = $scope.accountData.filter(function (obj) {
                    return obj.typ === 500 && !obj.active;
                }).map(x => Number(x.amount)).reduce((x, y) => x + y, 0);

                /* Get extern Wealth */
                var rebels = $scope.accountData.filter(function (obj) {
                    return !obj.internal && !obj.realEstateAmount;
                });
                $rootScope.master.wealth.extern = rebels.map(x => Number(x.amount)).reduce((x, y) => x + y, 0);

                /* Get selectAmount */
                var rebels1 = $scope.accountData.filter(function (obj) {
                    return obj.active;
                });
                var rebels2 = $scope.accountData.filter(function (obj) {
                    return obj.data;
                });

                let xx = 0;
                rebels2.forEach(function (item){
                    item.data.forEach(function (item, index){

                        if(item.sell){
                            xx = xx + item.selectAmount
                        }
                    })
                })

                $rootScope.master.wealth.selectAmount = rebels1.map(x => Number(x.selectAmount)).reduce((x, y) => x + y, 0) + xx;

            }, true);

            /* NAV */
            $scope.navs = [
                { title: "layers", href : "status", tooltip: "status"},
                { title: "view_in_ar_new", href : "select", tooltip: "overview"},
                { title: "join_right", href : "offer", tooltip: "offer"}
            ]

            $rootScope.navActions = [
                {}
            ]

            $scope.$watch("master.plans", function() {
                let kft = 0;
                $rootScope.master.plans.forEach(function (item){
                    if (item.amount && item.sub == 0){
                        kft = kft + Number(item.amount)
                    }
                })
                $scope.kft = kft;

                $rootScope.master.wealth.plans = $rootScope.master.plans.map(x => Number(x.amount)).reduce((x, y) => x + y, 0);
            }, true);

        }])

        ng.controller('home-tasks', ['$scope','$http', function($scope, $http) {

            /* Get Tasks*/
            $http.get("../tasks.json").then(function(res) {
                $scope.tasks = res.data;

                /* Get Customer Data */
                $http.get("../customers.json").then(function(res) {

                    for (const [key, value] of Object.entries($scope.tasks)) {
                        $scope.tasks[key].customerInfo = res.data[$scope.tasks[key].customerId];
                    }

                });
            });

        }])

        ng.controller('status', ['$scope','$rootScope', function($scope,$rootScope) {
            $rootScope.navActions = [
                { ico: "add", title: "", modal: "modal"}
            ]
            $scope.selectKindWealth = [
                {typ:200, title:'Girokonto'}
            ];
            $scope.plansText = ['Kurzfristig','Mittelfristig','Langfristig']
            $scope.plans = []
            $scope.plans.eventSlide = 0;

            $scope.addPlans = function (){
                $rootScope.master.plans.push({
                    title : $scope.plans.title,
                    amount : $scope.plans.amount,
                    text : $scope.plans.text,
                    sub : $scope.plans.sub
                })
                $scope.plans = [];
            }

            $scope.editPlans = function (id){
                $scope.plans = $rootScope.master.plans[id];
                $rootScope.master.plans.splice(id, 1);
            }

            $scope.addWealth = function (){
                $scope.slave['typ'] = $scope.slave.select.typ;
                $scope.slave['title'] = $scope.slave.select.title;
                delete $scope.slave.select;
                $scope.accountData.push($scope.slave)
                delete $scope.slave;
                delete $scope.selected;
            }
            $scope.editWealth = function (id){
                $scope.slave = $scope.accountData[id];
                $scope.slave.select = {typ: $scope.accountData[id].typ, title: $scope.accountData[id].title}
                $scope.selected = $scope.accountData[id].typ;
                $scope.accountData.splice(id, 1);
            }

            const myChart = new Chart(
                document.getElementById('myChart'),
                {
                    type: 'doughnut',
                    data: {
                        labels: ['Liquidit√§t', 'Sicherheit', 'Rendite'],
                        datasets: [{
                            data: [
                                1,
                                1,
                                1]
                        }]
                    },
                    options: {
                        plugins: {
                            legend: {
                                position: "right"
                            }
                        }
                    }
                }
            );

            $scope.$watch("accountData", function(obj) {

                myChart.data.datasets[0].data = [
                    $rootScope.master.wealth.liqui,
                    $rootScope.master.wealth.sec,
                    $rootScope.master.wealth.ren
                ];
                myChart.update();
            }, true);

            $scope.addMonths = function ()
            {
                const date = new Date();
                $scope.plans.event = new Date(date.setMonth(date.getMonth()+$scope.plans.eventSlide));
            }

        }])

        ng.controller('select', ['$scope','$rootScope','$http', function($scope,$rootScope,$http) {
            $rootScope.navActions = []
            $scope.sh = true;

            $scope.getRisk = function (obj){

                if(!obj) {
                    $rootScope.risk = [];
                }

                $http.get(obj)
                    .then(function(res){
                        $rootScope.risk = res.data;

                        $http.get("../portfolio.json")
                            .then(function(res){
                                $rootScope.portfolio = res.data[$rootScope.risk.class];

                            });
                    });

            }

        }])

        ng.controller('offer', ['$scope','$rootScope', function($scope,$rootScope) {
            $rootScope.navActions = [
                { ico: "print", title: "", modal: "modal", href:"javascript:print()"}
            ]

            $scope.performance4 = function (a,p){
                let x = Number(a);

                for (const [key, value] of Object.entries(p)) {
                    if(typeof value == 'number'){
                        x = x + (x*value)
                    }
                }
                return (x);
            }
        }])

        ng.controller('products', ['$scope','$rootScope','$http', function($scope,$rootScope,$http) {
            $http.get('../fonds.json')
                .then(function(res){
                    if(!$scope.risk) return;
                    $rootScope.products = res.data.filter(function (obj) {
                        return obj.risk <= $scope.risk.class;
                    });
                });

            $scope.addProduct = function (obj){
                if(!$rootScope.productsSelect){
                    $rootScope.productsSelect = [];
                }
                $rootScope.productsSelect.push(obj)
            }
        }])

        /* Directive */

        ng.directive("addWealth", [function() {
            return {
                restrict: 'C',
                templateUrl:
                    './module/wealth-module.html'
            };
        }]).directive("plansitem", [function() {
            return {
                restrict: 'C',
                template:
                    '<div style="padding: 8px 16px" ng-click="editPlans($index)">' +
                        '<div style="float: right">' +
                            '<span>({{plansText[pl.sub]}})</span>' +
                        '</div>' +
                        '<b>{{pl.title}}</b> ' +
                        '<div>{{pl.amount | currency:"EUR":0}}</div>' +
                        '<div class="text fadein">{{pl.text}}</div>' +
                    '</div>'
            };
        }]).directive("footer", [function() {
            return {
                restrict: 'C',
                template:
                    '<p style="color: #5f6368">Designed and built @Patrick Nolte 2022-2023</p>'
            };
        }])
    })();
</script>
</html>